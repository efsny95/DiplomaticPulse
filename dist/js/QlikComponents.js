function Export(t){function e(){a.getLayout().then(function(t){i.empty(),r.empty();var e=$("<tr />");t.qHyperCube.qDimensionInfo.forEach(function(t){$("<th>"+t.qFallbackTitle+"</th>").appendTo(e)}),e.appendTo(r),t.qHyperCube.qDataPages[0].qMatrix.some(function(t,e){var n=$("<tr/>");return t.forEach(function(t){$("<td>"+t.qText+"</td>").appendTo(n)}),n.appendTo(i),75===e})})}function n(){var t="DPExport_"+new Date(Date.now()).toISOString().substring(0,16);a.exportData("CSV_C","/qHyperCubeDef",t).then(function(t){window.open("https://"+QIX.config.host+t,"_blank")})}var a,i=$("#exporttable tbody"),r=$("#exporttable thead"),s=t.map(function(t){return{qNullSuppression:!0,qDef:{qFieldDefs:[t],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"ExportHyperCube"},qHyperCubeDef:{qDimensions:s,qInterColumnSortOrder:[0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:500,qWidth:s.length+1}]}}).then(function(t){a=t,e()});pubsub.subscribe("export",n),pubsub.subscribe("update",e)}function Filter(t,e,n,a){function i(t){o.getLayout().then(function(t){u=t.qInfo.qId,b.find("ul").remove();var e=t.qListObject.qDataPages[0].qMatrix,a=t.qListObject.qDimensionInfo.qStateCounts.qSelected;a>0?(c=!0,m.visible().text(a+" of "+t.qListObject.qSize.qcy)):(c=!1,m.invisible());var i=$('<ul class="list" />');i.html(e.map(function(t){return'<li data-elem="'+t[0].qElemNumber+'" class="'+t[0].qState+' listitem"><p class="value">'+t[0].qText+"</p></li>"})),i.find("li").on("click",function(){s($(this).attr("data-elem"))}),i.appendTo(b),l||(f.appendTo(n),l=!0),p&&r(),$("input.search").val("")})}function r(){0===$("#"+q).find(".search").length&&$("#"+q).find(".items").before('<input class="search" placeholder="Search list"/>');new List($("#"+q),{valueNames:["value"]})}function s(e){o.selectListObjectValues("/qListObjectDef",[+e],"DateRange"==t?!1:!0,!1).then(function(t){$("#clearfilter").addClass("active"),pubsub.publish("update")})}var o,u,l=!1,c=!1,p=a||!1,q=e.replace(/\s+/g,"").replace(/\./g,""),d='<div id="'+q+'" class="filter">';d+='<div class="title">'+e,d+='  <div class="right"><div class="count"></div><img src="static/img/toggle.svg"></div>',d+="</div>",d+='<div class="items"></div>',d+="</div>";var f=$(l?"#"+q:d),b=f.find(".items"),h=f.find(".title"),m=f.find(".count");h.on("click",function(){$(this).parent().toggleClass("expanded")});var g="DateRange"==t?{qSortByNumeric:1}:{qSortByAsci:1};QIX.app.createSessionObject({qInfo:{qId:"",qType:"ListObject"},qListObjectDef:{qLibraryId:"",qDef:{qFieldDefs:[t],qSortCriterias:[g]},qInitialDataFetch:[{qTop:0,qHeight:300,qLeft:0,qWidth:1}]}}).then(function(t){o=t,i()});var y=pubsub.subscribe("update",i);pubsub.subscribe("kill",function(){QIX.app.destroySessionObject(u),pubsub.unsubscribe(y)})}function Linechart(t,e,n){function a(){r.getLayout().then(function(t){f.selectAll("path, .axis").remove(),s=t.qHyperCube.qDataPages[0].qMatrix.filter(function(t){return t[0].qText.length&&+t[1].qNum===(0|+t[1].qNum)}).map(function(t){return{date:h(t[0].qText),value:t[1].qNum}},[]).sort(function(t,e){return t.date-e.date}),c.domain(d3.extent(s,function(t){return t.date})),l.domain(d3.extent(s,function(t){return t.value})),b.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")").call(p),b.append("g").attr("class","y axis").call(q),b.append("path").datum(s).attr("class","line").attr("d",d).style("fill","none").style("stroke","steelblue").style("stroke-width","1.5px")})}function i(){f.selectAll("path, g").remove(),b=f.append("g").attr("transform","translate("+m.left+","+m.top+")"),o=n.offsetWidth-m.left-m.right,u=o/1.2-m.top-m.bottom,c=d3.time.scale().range([0,o]),l=d3.scale.linear().range([u,0]),p=d3.svg.axis().scale(c).ticks(3).orient("bottom"),q=d3.svg.axis().scale(l).ticks(3).orient("left"),f.attr("width",o+m.left+m.right).attr("height",u+m.top+m.bottom),a()}var r,s,o,u,l,c,p,q,d,f,b,h=d3.time.format("%Y-%m-%d").parse,m={top:20,right:20,bottom:30,left:40};o=n.offsetWidth-m.left-m.right,u=o/1.2-m.top-m.bottom,c=d3.time.scale().range([0,o]),l=d3.scale.linear().range([u,0]),p=d3.svg.axis().scale(c).ticks(3).orient("bottom"),q=d3.svg.axis().scale(l).ticks(3).orient("left"),d=d3.svg.line().x(function(t){return c(t.date)}).y(function(t){return l(t.value)}),f=d3.select(n).append("svg").attr("width",o+m.left+m.right).attr("height",u+m.top+m.bottom),b=f.append("g").attr("transform","translate("+m.left+","+m.top+")"),QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:[{qNullSuppression:!0,qDef:{qFieldDefs:[t],qFieldLabels:["Test"],qSortCriterias:[{qSortByNumeric:-1}]}}],qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:"",qDescription:"",qDef:e}}],qInterColumnSortOrder:[0,1],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:30,qWidth:2}]}}).then(function(t){r=t,a()});var g=pubsub.subscribe("update",a);pubsub.subscribe("kill",function(){pubsub.unsubscribe(g)}),pubsub.subscribe("resize",i)}function Table(t,e,n){function a(){u.getLayout().then(function(t){if($(n).empty(),t.qHyperCube.qDataPages[0].qMatrix[0][0].qIsEmpty)return void $("<p>No Mentions Available</p>").appendTo($(n));var e=$("<table />"),a=r(t),s=$("<tbody />");l=d3.max(t.qHyperCube.qDataPages[0].qMatrix,function(t){return t[1].qNum}),t.qHyperCube.qDataPages[0].qMatrix.forEach(function(t){var e=i(t);e.appendTo(s)}),a.appendTo(e),s.appendTo(e),e.appendTo($(n))},function(t){console.log(t)})}function i(t){var e=t[1].qNum/l*100,n=$("<tr/>");return $('<td id="'+t[0].qElemNumber+'" class="col col1">'+t[0].qText+"</td>").click(function(t){s(+$(this).attr("id"))}).appendTo(n),$('<td class="col col2"><div style="width:'+e+'%;"></div></td>').appendTo(n),$('<td class="col col3">'+t[1].qNum+"</td>").appendTo(n),n}function r(t){var e=[],n=$("<thead />");return t.qHyperCube.qDimensionInfo.forEach(function(t){e.push(o(t.qFallbackTitle))}),e.push(t.qHyperCube.qMeasureInfo[0].qFallbackTitle),e.forEach(function(t,e){1==e?$('<th colspan="2" class="col col'+(e+1)+'">'+t+"</th>").appendTo(n):$('<th class="col col'+(e+1)+'">'+t+"</th>").appendTo(n)}),n}function s(t){u.selectHyperCubeValues("/qHyperCubeDef",0,[t],!0).then(function(t){pubsub.publish("update")})}function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}var u,l,c=t.map(function(t){return{qNullSuppression:!0,qDef:{qFieldDefs:[t.dim],qFieldLabels:[t.label],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:c,qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:e.label,qDescription:"",qDef:e.value}}],qInterColumnSortOrder:[1,0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:10,qWidth:c.length+1}]}}).then(function(t){u=t,a()});var p=pubsub.subscribe("update",a);pubsub.subscribe("kill",function(){pubsub.unsubscribe(p)})}function ContentTable(t,e){function n(){s.getLayout().then(function(t){t.qHyperCube.qDataPages[0].qMatrix.length<l?c.hide():c.show(),o=t.qHyperCube.qSize.qcy,p.empty();var e=t.qHyperCube.qDataPages[0].qMatrix;e.forEach(function(t){if(!t[1].qIsEmpty){var e;e="Twitter"===t[0].qText?i(t):r(t),e.appendTo(p)}})},function(t){console.log(t)})}function a(){u+=l;var t={qTop:u,qLeft:0,qHeight:l,qWidth:d.length+1};s.getHyperCubeData("/qHyperCubeDef",[t]).then(function(t){t[0].qMatrix.length<l&&$("#more").hide(),t[0].qMatrix.forEach(function(t){if(!t[1].qIsEmpty){var e;e="Twitter"===t[0].qText?i(t):r(t),e.appendTo(p)}})})}function i(t){var e=$('<div class="item" />');$('<div class="info"><i class="fa fa-twitter"></i>&nbsp;&nbsp;'+t[1].qText+q+t[2].qText+"</div>").appendTo(e),$('<div class="body">'+t[3].qText+"</div>").appendTo(e);var n='<div class="details" style="display: none;"><img style="display: none;width: 100%;"></img><div class="details-bar">';n+='<ul><li class="retweet">RETWEETS <strong>'+t[8].qText+"</strong>",n+='</li><li class="favorite">FAVORITES <strong>'+t[7].qText+"</strong></li>",n+='<li class="handle">TWITTER HANDLE <strong>'+t[4].qText.substring(1)+"</strong></li><li></li></ul>",n+='<a target="_blank" href="'+t[5].qText+'">Read on Twitter</a><a target="_blank" href="https://twitter.com/'+t[4].qText+'">View Twitter profile</a></div>';var a=$(n);return"-"!=t[9].qText&&(e.find(".info").append('<i class="fa fa-picture-o"></i>'),a.find("img").attr("src",t[9].qText).show()),a.appendTo(e),e.on("click",function(t){return"A"==t.target.nodeName?null:void $(this).find(".details").slideToggle("fast")}),e}function r(t){var e=$('<div class="item" />');$('<div class="info"><i class="fa fa-cloud"></i>&nbsp;&nbsp;'+t[1].qText+q+t[2].qText.substring(0,17)+"</div>").appendTo(e),$('<div class="body">'+t[3].qText+"</div>").appendTo(e);var n='<div class="details" style="display: none;"><div class="details-bar">';n+='<ul><li class="documenttype">DOCUMENT TYPE <strong>'+t[6].qText+"</strong></li></ul>",n+='<a target="_blank" href="'+t[5].qText+'">Read document</a><a target="_blank" href="//'+t[4].qText+'">Visit source site</a>',n+="</div></div>";var a=$(n);return a.appendTo(e),e.on("click",function(){$(this).find(".details").slideToggle("fast")}),e}var s,o,u=0,l=30,c=$("#more"),p=e.find(".rows"),q="&nbsp;&nbsp;-&nbsp;&nbsp;",d=t.map(function(t){return{qDef:{qFieldDefs:[t],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:d,qInterColumnSortOrder:[2],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:l,qWidth:d.length+1}]}}).then(function(t){s=t,n()});var f=pubsub.subscribe("update",n);pubsub.subscribe("kill",function(){pubsub.unsubscribe(f)}),c.click(function(t){a()})}function WordCloud(t,e,n){function a(){s.getLayout().then(function(t){function e(e,n,i){p.selectAll("text").remove(),q=n?Math.min(l/Math.abs(n[1].x-l/2),l/Math.abs(n[0].x-l/2),c/Math.abs(n[1].y-c/2),c/Math.abs(n[0].y-c/2))/2:1;var o=s.selectAll("text").data(e,function(t){return t.text});o.enter().append("text").on("click",function(t){r(t.qElem)}).attr("class","hash").attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")"}).style("font-size",function(t){return t.size+"px"}).style("cursor","pointer").style("opacity",function(e){return t.qHyperCube.qDataPages[0].qMatrix.length>1?a(e.value)/100:1}).style("fill","rgb(39, 48, 81)").text(function(t){return t.text})}if(p.attr("width",l).attr("height",c),t.qHyperCube.qDataPages[0].qMatrix[0][0].qIsEmpty)return void p.append("text").attr("text-anchor","middle").attr("transform",function(t){return"translate("+[l/2,c/2]+")"}).style("font-size","16px").style("fill","rgb(39, 48, 81)").text("No Hashtags Available");o=d3.max(t.qHyperCube.qDataPages[0].qMatrix.map(function(t){return t[1].qNum})),u=d3.min(t.qHyperCube.qDataPages[0].qMatrix.map(function(t){return t[1].qNum}));var n=d3.scale.log().range([16,d]);n.domain([u,o]);{var a=d3.scale.linear().range([60,100]).domain([u,o]),i=t.qHyperCube.qDataPages[0].qMatrix.map(function(t){return{key:t[0].qText,size:t[1].qNum,value:t[1].qNum,qElem:t[0].qElemNumber}}),s=(p.append("g"),p.append("g").attr("transform","translate("+[l>>1,c>>1]+")"));d3.layout.cloud().words(i).timeInterval(10).padding(2).size([l,c]).fontWeight("bold").spiral("rectangular").font("Impact").fontSize(function(e){return 1!=t.qHyperCube.qDataPages[0].qMatrix.length?n(+e.size):d}).rotate(0).text(function(t){return t.key}).on("end",e).start()}})}function i(){l!==n.offsetWidth&&(l=n.offsetWidth,c=n.offsetHeight,a())}function r(t){s.selectHyperCubeValues("/qHyperCubeDef",0,[t],!0).then(function(t){pubsub.publish("update")})}var s,o,u,l=n.offsetWidth,c=n.offsetWidth,p=d3.select(n).append("svg").attr("id","svgwordcloud"),q=1,d=42;QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:[{qNullSuppression:!0,qDef:{qFieldDefs:[t],qFieldLabels:["Test"],qSortCriterias:[{qSortByNumeric:-1}]}}],qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:"",qDescription:"",qDef:e}}],qInterColumnSortOrder:[1,0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:50,qWidth:2}]}}).then(function(t){s=t,a()});var f=pubsub.subscribe("update",a);pubsub.subscribe("kill",function(){pubsub.unsubscribe(f)});pubsub.subscribe("resize",i)}function WorldMap(t,e,n){function a(){QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:h,qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:"",qDescription:"",qDef:e}}],qInterColumnSortOrder:[2],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:g,qWidth:h.length+1}]}}).then(function(t){o=t,i()})}function i(){o.getLayout().then(function(t){y.selectAll("circle").remove();var e,n=t.qHyperCube.qMeasureInfo[0].qMax,a=t.qHyperCube.qMeasureInfo[0].qMin;e=d3.scale.sqrt().domain([a,n]).range(300>f?[0,15]:[0,25]),m={},t.qHyperCube.qDataPages[0].qMatrix.forEach(function(t){m[t[0].qText]={value:t[2].qNum,name:t[1].qText,elem:t[0].qElemNumber}});var i=u.features.filter(function(t){return m.hasOwnProperty(t.id)});y.selectAll("circle").attr("class","bubble").data(i).enter().append("circle").attr("cx",function(t){return d.centroid(t)[0]}).attr("cy",function(t){return d.centroid(t)[1]}).attr("r",function(t){return e(m[t.id].value)}).on("mouseover",v.show).on("mouseout",v.hide).on("click",function(t,e){s(m[t.id].elem)})})}function r(){y.selectAll("path, circle").remove(),f=n.offsetWidth,b=f/1.5,y.attr("width",f).attr("height",b),q=d3.geo.mercator().scale(1).translate([0,0]),d=d3.geo.path().projection(q),l=d.bounds(u),c=.95/Math.max((l[1][0]-l[0][0])/f,(l[1][1]-l[0][1])/b),p=[(f-c*(l[1][0]+l[0][0]))/2,(b-c*(l[1][1]+l[0][1]))/2],q.scale(c).translate(p),y.selectAll("path").data(u.features).enter().append("path").attr("d",d),i()}function s(t){o.selectHyperCubeValues("/qHyperCubeDef",0,[t],!0).then(function(t){pubsub.publish("update")})}var o,u,l,c,p,q,d,f,b,h=t.map(function(t){return{qNullSuppression:!0,qDef:{qFieldDefs:[t.dim],qFieldLabels:[t.label],qSortCriterias:[{qSortByNumeric:-1}]}}}),m={},g=500;f=n.offsetWidth,b=f/1.5,q=d3.geo.mercator().scale(1).translate([0,0]),d=d3.geo.path().projection(q);var y=d3.select(n).append("svg").attr("width",f).attr("height",b),v=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<span>"+m[t.id].name+": "+m[t.id].value+" </span>"});y.call(v),d3.json("/static/data/world.geo.json",function(t,e){return t?console.error(t):(u=e,l=d.bounds(u),c=.95/Math.max((l[1][0]-l[0][0])/f,(l[1][1]-l[0][1])/b),p=[(f-c*(l[1][0]+l[0][0]))/2,(b-c*(l[1][1]+l[0][1]))/2],q.scale(c).translate(p),y.selectAll("path").data(e.features).enter().append("path").attr("d",d),void a())});var x=pubsub.subscribe("update",i);pubsub.subscribe("kill",function(){pubsub.unsubscribe(x)}),pubsub.subscribe("resize",r)}!function(t){t.fn.invisible=function(){return this.each(function(){t(this).css("visibility","hidden")})},t.fn.visible=function(){return this.each(function(){t(this).css("visibility","visible")})}}(jQuery);