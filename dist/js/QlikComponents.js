function Export(e){function t(){a.getLayout().then(function(e){i.empty(),r.empty(),$(".exportarea").first("<p>Showing the first  rows out of  available rows.");var t=$("<tr />");e.qHyperCube.qDimensionInfo.forEach(function(e){$("<th>"+e.qFallbackTitle+"</th>").appendTo(t)}),t.appendTo(r),e.qHyperCube.qDataPages[0].qMatrix.forEach(function(e){var t=$("<tr/>");e.forEach(function(e){$("<td>"+e.qText+"</td>").appendTo(t)}),t.appendTo(i)})})}function n(){var e="DPExport_"+new Date(Date.now()).toISOString().substring(0,16);a.exportData("CSV_C","/qHyperCubeDef",e).then(function(e){window.open("https://"+QIX.config.host+e,"_blank")})}var a,i=$("#exporttable tbody"),r=$("#exporttable thead"),u=e.map(function(e){return{qNullSuppression:!0,qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"ExportHyperCube"},qHyperCubeDef:{qDimensions:u,qInterColumnSortOrder:[0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:75,qWidth:u.length+1}]}}).then(function(e){a=e,t()});pubsub.subscribe("export",n),pubsub.subscribe("update",t)}function Filter(e,t,n,a){function i(e){o.getLayout().then(function(e){s=e.qInfo.qId,b.find("ul").remove();var t=e.qListObject.qDataPages[0].qMatrix,a=e.qListObject.qDimensionInfo.qStateCounts.qSelected;a>0?(l=!0,h.visible().text(a+" of "+e.qListObject.qSize.qcy)):(l=!1,h.invisible());var i=$('<ul class="list" />');i.html(t.map(function(e){return'<li data-elem="'+e[0].qElemNumber+'" class="'+e[0].qState+' listitem"><p class="value">'+e[0].qText+"</p></li>"})),i.find("li").on("click",function(){u($(this).attr("data-elem"))}),i.appendTo(b),c||(f.appendTo(n),c=!0),q&&r(),$("input.search").val("")})}function r(){0===$("#"+e).find(".search").length&&$("#"+e).find(".items").before('<input class="search" placeholder="Search list"/>');new List(e,{valueNames:["value"]})}function u(t){o.selectListObjectValues("/qListObjectDef",[+t],"DateRange"==e?!1:!0,!1).then(function(e){$("#clearfilter").addClass("active"),pubsub.publish("update")})}var o,s,c=!1,l=!1,q=a||!1,p='<div id="'+e+'" class="filter">';p+='<div class="title">'+t,p+='  <div class="right"><div class="count"></div><img src="static/img/toggle.svg"></div>',p+="</div>",p+='<div class="items"></div>',p+="</div>";var f=$(c?"#"+e:p),b=f.find(".items"),d=f.find(".title"),h=f.find(".count");d.on("click",function(){$(this).parent().toggleClass("expanded")});var y="DateRange"==e?{qSortByNumeric:1}:{qSortByAsci:1};QIX.app.createSessionObject({qInfo:{qId:"",qType:"ListObject"},qListObjectDef:{qLibraryId:"",qDef:{qFieldDefs:[e],qSortCriterias:[y]},qInitialDataFetch:[{qTop:0,qHeight:300,qLeft:0,qWidth:1}]}}).then(function(e){o=e,i()});var m=pubsub.subscribe("update",i);pubsub.subscribe("kill",function(){QIX.app.destroySessionObject(s),pubsub.unsubscribe(m)})}function Table(e,t,n){function a(){s.getLayout().then(function(e){$(n).empty();var t=$("<table />"),a=r(e),u=$("<tbody />");c=d3.max(e.qHyperCube.qDataPages[0].qMatrix,function(e){return e[1].qNum}),e.qHyperCube.qDataPages[0].qMatrix.forEach(function(e){var t=i(e);t.appendTo(u)}),a.appendTo(t),u.appendTo(t),t.appendTo($(n))},function(e){console.log(e)})}function i(e){var t=e[1].qNum/c*100,n=$("<tr/>");return $('<td id="'+e[0].qElemNumber+'" class="col col1">'+e[0].qText+"</td>").click(function(e){u(+$(this).attr("id"))}).appendTo(n),$('<td class="col col2"><div style="width:'+t+'%;"></div></td>').appendTo(n),$('<td class="col col3">'+e[1].qNum+"</td>").appendTo(n),n}function r(e){var t=[],n=$("<thead />");return e.qHyperCube.qDimensionInfo.forEach(function(e){t.push(o(e.qFallbackTitle))}),t.push(e.qHyperCube.qMeasureInfo[0].qFallbackTitle),t.forEach(function(e,t){1==t?$('<th colspan="2" class="col col'+(t+1)+'">'+e+"</th>").appendTo(n):$('<th class="col col'+(t+1)+'">'+e+"</th>").appendTo(n)}),n}function u(e){s.selectHyperCubeValues("/qHyperCubeDef",0,[e],!0).then(function(e){pubsub.publish("update")})}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}var s,c,l=e.map(function(e){return{qNullSuppression:!0,qDef:{qFieldDefs:[e.dim],qFieldLabels:[e.label],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:l,qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:t.label,qDescription:"",qDef:t.value}}],qInterColumnSortOrder:[1,0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:10,qWidth:l.length+1}]}}).then(function(e){s=e,a()});var q=pubsub.subscribe("update",a);pubsub.subscribe("kill",function(){pubsub.unsubscribe(q)})}function ContentTable(e,t){function n(){r.getLayout().then(function(e){e.qHyperCube.qDataPages[0].qMatrix.length<s?c.hide():c.show(),u=e.qHyperCube.qSize.qcy,l.empty();var t=e.qHyperCube.qDataPages[0].qMatrix;t.forEach(function(e){if(!e[1].qIsEmpty){var t=i(e);t.appendTo(l)}})},function(e){console.log(e)})}function a(){o+=s;var e={qTop:o,qLeft:0,qHeight:s,qWidth:p.length+1};r.getHyperCubeData("/qHyperCubeDef",[e]).then(function(e){e[0].qMatrix.length<s&&$("#more").hide(),e[0].qMatrix.forEach(function(e){if(!e[1].qIsEmpty){var t=i(e);t.appendTo(l)}})})}function i(e){var t=$('<div class="item" />'),n="Web"==e[0].qText?"fa-cloud":"fa-twitter";return $('<div class="info"><i class="fa '+n+'"></i>'+q+e[4].qText+q+e[5].qText.substring(0,16)+"</div>").appendTo(t),$('<div class="body">'+e[2].qText+"</div>").appendTo(t),t}var r,u,o=0,s=30,c=$("#more"),l=t.find(".rows"),q="&nbsp;&nbsp;|&nbsp;&nbsp;",p=e.map(function(e){return{qDef:{qFieldDefs:[e],qSortCriterias:[{qSortByNumeric:-1}]}}});QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:p,qInterColumnSortOrder:[5],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:s,qWidth:p.length+1}]}}).then(function(e){r=e,n()});var f=pubsub.subscribe("update",n);pubsub.subscribe("kill",function(){pubsub.unsubscribe(f)}),c.click(function(e){a()})}function WordCloud(e,t,n){function a(){r.getLayout().then(function(e){function t(t,r,u){q=r?Math.min(s/Math.abs(r[1].x-s/2),s/Math.abs(r[0].x-s/2),c/Math.abs(r[1].y-c/2),c/Math.abs(r[0].y-c/2))/2:1;var o=f.selectAll("text").data(t,function(e){return e.text});o.transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")"}).style("font-size",function(e){return n(e.value)+"px"}),o.enter().append("text").on("click",function(e){i(e.qElem)}).attr("class","hash").attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+")"}).style("font-size",function(e){return e.size+"px"}).style("cursor","pointer").style("opacity",function(t){return e.qHyperCube.qDataPages[0].qMatrix.length>1?a(t.value)/100:1}).style("fill","rgb(39, 48, 81)").text(function(e){return e.text})}if(l.attr("width",s).attr("height",c),l.selectAll("text").remove(),!e.qHyperCube.qDataPages[0].qMatrix[0][0].qIsEmpty){{e.qHyperCube.qDimensionInfo[0].qApprMaxGlyphCount}u=d3.max(e.qHyperCube.qDataPages[0].qMatrix.map(function(e){return e[1].qNum})),o=d3.min(e.qHyperCube.qDataPages[0].qMatrix.map(function(e){return e[1].qNum}));var n=d3.scale.log().range([16,p]);n.domain([o,u]);{var a=d3.scale.linear().range([60,100]).domain([o,u]),r=e.qHyperCube.qDataPages[0].qMatrix.map(function(e){return{key:e[0].qText,size:e[1].qNum,value:e[1].qNum,qElem:e[0].qElemNumber}}),f=(l.append("g"),l.append("g").attr("transform","translate("+[s>>1,c>>1]+")"));d3.layout.cloud().words(r).timeInterval(10).padding(2).size([s,c]).fontWeight("bold").spiral("rectangular").font("Impact").fontSize(function(t){return 1!=e.qHyperCube.qDataPages[0].qMatrix.length?n(+t.size):p}).rotate(function(){return 0}).text(function(e){return e.key}).on("end",t).start()}}})}function i(e){r.selectHyperCubeValues("/qHyperCubeDef",0,[e],!0).then(function(e){pubsub.publish("update")})}var r,u,o,s=n.offsetWidth,c=n.offsetWidth,l=d3.select(n).append("svg").attr("id","svgwordcloud"),q=1,p=32;QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:[{qNullSuppression:!0,qDef:{qFieldDefs:[e]}}],qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:"",qDescription:"",qDef:t}}],qInterColumnSortOrder:[1,0],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:40,qWidth:2}]}}).then(function(e){r=e,a()});var f=pubsub.subscribe("update",a);pubsub.subscribe("kill",function(){pubsub.unsubscribe(f)})}function WorldMap(e,t,n){function a(){QIX.app.createSessionObject({qInfo:{qId:"",qType:"HyperCube"},qHyperCubeDef:{qDimensions:f,qMeasures:[{qLibraryId:"",qSortBy:{qSortByNumeric:-1},qDef:{qLabel:"",qDescription:"",qDef:t}}],qInterColumnSortOrder:[2],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:d,qWidth:f.length+1}]}}).then(function(e){u=e,i()})}function i(){u.getLayout().then(function(e){m.selectAll("circle").remove();var t=e.qHyperCube.qMeasureInfo[0].qMax,n=(e.qHyperCube.qMeasureInfo[0].qMin,d3.scale.sqrt().domain([0,t]).range([0,25]));b={},e.qHyperCube.qDataPages[0].qMatrix.forEach(function(e){b[e[0].qText]={value:e[2].qNum,name:e[1].qText,elem:e[0].qElemNumber}});var a=o.features.filter(function(e){return b.hasOwnProperty(e.id)});m.selectAll("circle").attr("class","bubble").data(a).enter().append("circle").attr("cx",function(e){return p.centroid(e)[0]}).attr("cy",function(e){return p.centroid(e)[1]}).attr("r",function(e){return n(b[e.id].value)}).on("mouseover",v.show).on("mouseout",v.hide).on("click",function(e,t){r(b[e.id].elem)})})}function r(e){u.selectHyperCubeValues("/qHyperCubeDef",0,[e],!0).then(function(e){pubsub.publish("update")})}var u,o,s,c,l,q,p,f=e.map(function(e){return{qNullSuppression:!0,qDef:{qFieldDefs:[e.dim],qFieldLabels:[e.label],qSortCriterias:[{qSortByNumeric:-1}]}}}),b={},d=500,h=n.offsetWidth,y=h/1.5;q=d3.geo.mercator().scale(1).translate([0,0]),p=d3.geo.path().projection(q);var m=d3.select(n).append("svg").attr("width",h).attr("height",y),v=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return"<span>"+b[e.id].name+": "+b[e.id].value+" </span>"});m.call(v),d3.json("/static/data/world.geo.json",function(e,t){return e?console.error(e):(o=t,s=p.bounds(t),c=.95/Math.max((s[1][0]-s[0][0])/h,(s[1][1]-s[0][1])/y),l=[(h-c*(s[1][0]+s[0][0]))/2,(y-c*(s[1][1]+s[0][1]))/2],q.scale(c).translate(l),m.selectAll("path").data(t.features).enter().append("path").attr("d",p),void a())});var g=pubsub.subscribe("update",i);pubsub.subscribe("kill",function(){pubsub.unsubscribe(g)})}